# Chapter 2. 光照及阴影

## 1. 像素亮度

三因素影响像素亮度

- 照相机响应
  - 感光元件对于中等强度光线呈线性反应，对于较暗较亮则非线性。
- 表面反射
  - 漫反射，一般反射率分布在0.05~0.90之间
    - 漫反射可以通过图像估计得到
  - 镜面反射
    - 镜面反射率通常不可估算
  - 镜面收到轻微损伤，高光镜面反射
- 照度
  - 取决于光源总量度与表面形状。

### 朗伯余弦定律

此定律反应远点光源照明（太阳光、平行光源)照射下的漫反射表面亮度：

$I=\rho I_0 cos \theta$

其中$I_0$ 是光源亮度，$\theta$是入射光与表面发现夹角，$\rho$是漫反射率

### 朗伯+镜面反射模型

绝大多数的情况下，所有表面都可以看成具有高光现象的光线散射过程。

$I(x)= \rho(x)(N\cdot S)Vis(S,x) + \rho(x)A+M$

图像明暗强度=漫反射+环境光强+镜面反射

$N(x)$指表面法向量，$S(x)$指从x指向光源的向量，长度为$I_0$

### 面光源

可以理解为多点拼接的光源。那么可以产生三种照亮效果，一是完全受光照，一种是部分受光照（半影），一种是彻底不受光照。

## 2. 阴影

- 互易定理
  - $E\Delta t = E/k \cdot k\Delta t$ 也就是说，胶片的响应与快门时间与光照强度均成正比
- 辐射校准
  - 正因为互易定理，为了准确评估场景中的亮度
  - 通过对同一场景，进行多次不同曝光参数设置，那么可以获得高动态范围的图像（High Dynamic Range， HDR）
    那么，就有
    $I_{i,j}^{(k)}=f(E_{i,j}\Delta t_k)$
    其中f是相机光感强度函数，这对于R G B都有区别，并且对于对应的强度也有关系。
    由于f是单调（递增或者递减），令$g=f^{-1}$，则有$log g(I_{ij}^{(k)})=log E_{ij}+log \Delta t_k$
    引入平滑补偿参数来估计E

    `\Sigma_{ijk} (log g(I_{ij}^{(k)})-log E_{ij}-log \Delta t_k)^2 `+平滑补偿g
- 镜面反射
  观测方向V，反射光向量P，高光范围为$V\cdot P \ge 1-\varepsilon$，$\varepsilon$就是给定阈值
  可以对给定的反射点对应的单位曲面定义出来，获得对应的法线方程。

### 对亮度和照度的推理

- 内表征：通过图像推理得到的表面的自身属性
- ![img](https://pic2.zhimg.com/v2-26d3788c58a770c4e28dd4bcffdc3dfd_b.jpg)

  - 照度是一个客观的参量，是我们用仪器去检测在某一个面上实际到达的光的数量。
  - 亮度是指某一物体发射或者反射出来的光被人眼所感知的程度。
- 亮度恒常性

  - 同一光强下的不同图像块的强度对比
- 通过简化，可以将照相机在点x的响应C，是照度项I，反射率$\rho$和照相机常数量$k_c$的乘积

  $C(x)=k_cI(x)\rho(x)$

### 视网膜算法

在一系列不同照度下拍摄照片下，获得表面图像块重建。

在给定n个光源，并且知道对应的照度与摄像机的属性，也就是V。N(x)是对应的单位法向量

$I(x,y)=kB(x,y)=\rho(x)N(x)\cdot S_1=\rho(x,y)N(x,y)\cdot k S_1=g(x,y)\cdot V_1$

那么，对于图像中的一个点，

$\mathcal{V}=(V^T_1,... V^T_n)^T$

$I(x,y)=\mathcal{V}g(x,y)$

因为N是单位法向量，就可以得到对应的$|g(x,y)|=\rho(x,y)$，而$N(x,y)=g(x,y)/|g(x,y)|$

进一步的，为获得对应的图像的z坐标，假设图像表面$(x,y,f(x,y))$

### 辐射量与光量

详见[zhihu](https://zhuanlan.zhihu.com/p/443419170)

- 互反射
  - 互反射自然起到平滑作用。
  - 色彩掺和
  - 互反射带来边出的亮度变化

### 阴影形状
